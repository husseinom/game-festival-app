datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

enum Role {
    ADMIN
    VISITOR
    VOLUNTEER
    ORGANISATOR
    SUPER_ORGANISATOR
}

model User {
    id          Int         @id @default(autoincrement())

    name        String
    email       String      @unique
    password    String

    role        Role        @default(VISITOR)
}

model Festival {
    id              Int         @id @default(autoincrement())
    
    name            String
    logo            String
    location        String
    total_tables    Int
    startDate       DateTime
    endDate         DateTime

    // Reservations for this festival
    reservations    Reservation[]

    @@unique([name, location, startDate])
}

model Game_Publisher {
    id          Int         @id @default(autoincrement())
    
    name        String
    logo        String?

    @@unique([name])

    games       Game[]      // Relation to Game
    reservations Reservation[]
}

model Game {
    id                  Int             @id @default(autoincrement())
    game_publisher_id   Int             // Foreign key to Game_Publisher

    name                String
    type                String
    min_age             Int
    max_players         Int?
    logo_url            String?

    @@unique([name, game_publisher_id])

    // Relations
    publisher           Game_Publisher  @relation(fields: [game_publisher_id], references: [id])

    @@index([game_publisher_id])
}

model Reservant {
    reservant_id    Int     @id @default(autoincrement())

    name            String
    type            String
    reservations    Reservation[]
}

model Reservation {
    reservation_id           Int     @id @default(autoincrement())

    game_publisher_id        Int
    festival_id              Int
    reservant_id             Int

    status                   String
    comments                 String?

    is_publisher_presenting  Boolean @default(false)
    game_list_requested      Boolean @default(false)
    game_list_received       Boolean @default(false)
    games_received           Boolean @default(false)

    discount_amount          Float?
    discount_tables          Int?
    final_invoice_amount     Float?

    // Relations
    publisher                Game_Publisher @relation(fields: [game_publisher_id], references: [id])
    festival                 Festival       @relation(fields: [festival_id], references: [id])
    reservant                Reservant      @relation(fields: [reservant_id], references: [reservant_id])

    @@index([game_publisher_id])
    @@index([festival_id])
    @@index([reservant_id])
}