datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

enum Role {
    ADMIN
    VISITOR
    VOLUNTEER
    ORGANISATOR
    SUPER_ORGANISATOR
}

model User {
    id          Int         @id @default(autoincrement())

    name        String
    email       String      @unique
    password    String

    role        Role        @default(VISITOR)
}

model Festival {
    id              Int         @id @default(autoincrement())
    
    name            String
    location        String
    total_tables    Int
    startDate       DateTime
    endDate         DateTime
    priceZoneTypeId  Int?
    priceZoneType    PriceZoneType?  @relation(fields: [priceZoneTypeId], references: [id])
    priceZones      PriceZone[]

    // add opposite relation for MapZone
    mapZones        MapZone[]

    // Reservations for this festival
    reservations    Reservation[]

    @@unique([name, location, startDate])
}

model GamePublisher {
    id           Int     @id @default(autoincrement())
    name         String
    exposant     Boolean @default(false)
    distributeur Boolean @default(false)
    logoUrl      String? 

    games        Game[]
    reservations Reservation[]

}

model GameType {
    id    Int    @id @default(autoincrement())
    label String
    games Game[]
}

model MapZone{
    id     Int  @id @default(autoincrement())
    festival_id Int
    festival Festival  @relation(fields: [festival_id], references: [id])
    price_zone_id Int
    price_zone PriceZone @relation(fields: [price_zone_id], references: [id])
    name String

}

model PriceZoneType{
    id     Int     @id @default(autoincrement())
    key    String  @unique
    name   String
    festivals Festival[]
}

model PriceZone{
    id  Int   @id @default(autoincrement())
    festival_id Int
    festival Festival @relation(fields: [festival_id], references: [id])
    name  String
    table_price Float
    total_tables  Int?

    mapZones MapZone[]

}

model GameMechanism {
    id          Int     @id @default(autoincrement())
    label       String
    description String? @db.Text
    games       Game[]
}

model Game {
    id          Int      @id @default(autoincrement())
    name        String
    author      String?
    minPlayers  Int?
    maxPlayers  Int?
    minAge      Int?
    duration    Int?
    prototype   Boolean  @default(false)
    theme       String?  @db.Text
    description String?  @db.Text
    imageUrl    String?
    noticeUrl   String?
    videoUrl    String?

    // Relations
    publisherId Int?
    publisher   GamePublisher? @relation(fields: [publisherId], references: [id])

    typeId      Int?
    type        GameType?      @relation(fields: [typeId], references: [id])

    mechanisms  GameMechanism[]
}

model Reservant {
    reservant_id    Int     @id @default(autoincrement())

    name            String
    type            String
    reservations    Reservation[]
}

model Reservation {
    reservation_id           Int     @id @default(autoincrement())

    game_publisher_id        Int
    festival_id              Int
    reservant_id             Int

    status                   String
    comments                 String?

    is_publisher_presenting  Boolean @default(false)
    game_list_requested      Boolean @default(false)
    game_list_received       Boolean @default(false)
    games_received           Boolean @default(false)

    discount_amount          Float?
    discount_tables          Int?
    final_invoice_amount     Float?

    // Relations
    publisher                GamePublisher @relation(fields: [game_publisher_id], references: [id])
    festival                 Festival       @relation(fields: [festival_id], references: [id])
    reservant                Reservant      @relation(fields: [reservant_id], references: [reservant_id])

    @@index([game_publisher_id])
    @@index([festival_id])
    @@index([reservant_id])
}